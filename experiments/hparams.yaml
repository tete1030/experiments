default_conf:
    hparam_default: &DEFAULT
        learning_rate: 5.e-4
        lr_gamma: 0.1
        weight_decay: 0
        train_batch: 20
        test_batch: 20
        before_epoch: 0
        epochs: 220
        schedule: [150, 175, 200]

    model_hourglass: &MODEL_HOURGLASS
        flip: true
        stack: 3
        block: 1

    dataset_mpii: &DATASET_MPII
        selective: experiments/sel.npy
        label_sigma: 1
        label_sigma_decay: 0

hg:
    <<: *DEFAULT
    id: 1
    name: hg
    model:
        <<: *MODEL_HOURGLASS
        stack: 3
    dataset:
        <<: *DATASET_MPII

locate:
    <<: *DEFAULT
    id: 5
    name: locate
    learning_rate: 2.e-4
    train_batch: 32
    test_batch: 32
    model:
        hg_dim: 256
        bn: false
        parse_threshold: 0.1
        match_threshold_factor: 5
        eval_threshold_factor: 5
    dataset:
        label_sigma: 3

stretch:
    <<: *DEFAULT
    id: 1
    name: stretch
    learning_rate: 5.e-4
    train_batch: 7
    test_batch: 7
    model:
        hg_dim: 256
        bn: false
        max_person: 30
        stack: 3
        init_noise_factor: 5
        mid_noise_factor: 5
        use_outsider: true
        eval_threshold: 0.1
        loss_factor: [0.2, 0.3, 0.5]

back:
    <<: *DEFAULT
    id: 0
    name: back
    learning_rate: 5.e-4
    train_batch: 10
    test_batch: 10
    model:
        hg_dim: 256
        bn: false
        parse_threshold: 0.1

ae:
    <<: *DEFAULT
    id: 0
    name: ae
    learning_rate: 2.e-4
    lr_gamma: 0.5
    epochs: 200
    schedule: [100]
    train_batch: 2
    test_batch: 8
    model:
        nstack: 4
        hg_dim: 256
        increase: 128
        bn: false
        max_num_people: 30
        loss_det_cof: 1
        loss_push_cof: 1.e-3
        loss_pull_cof: 1.e-3

chain:
    <<: *DEFAULT
    id: 1
    name: chain
    learning_rate: 2.e-4
    lr_gamma: 0.5
    epochs: 200
    schedule: [100]
    train_batch: 8
    test_batch: 8
    model:
        nstack: 4
        hg_dim: 256
        increase: 128
        bn: false
        max_num_people: 30
        loss_det_cof: 1
        loss_field_cof: 0.0001
    dataset:
        label_field_radius: 2
    eval:
        detection_thres: 0.1
        group_thres: 0.86

ae2d:
    <<: *DEFAULT
    id: 0
    name: ae2d
    learning_rate: 1.e-4
    lr_gamma: 0.5
    epochs: 200
    schedule: [100]
    train_batch: 8
    test_batch: 8
    model:
        nstack: 4
        hg_dim: 256
        increase: 128
        inp_res: 512
        inp_res_ms: [512]
        out_res: 128
        bn: false
        max_num_people: 30
        loss_det_cof: 1
        loss_em_push_cof: 1.e-4
        loss_em_pull_cof: 1.e-4
    eval:
        detection_thres: 0.05
        group_thres: 0.1

baybase:
    <<: *DEFAULT
    id: 6
    name: baybase
    learning_rate: 5.e-4
    lr_gamma: 0.5
    epochs: 300
    schedule: [150]
    train_batch: 32
    test_batch: 32
    model:
        resnet_pretrained: pretrained/resnet50_gn.pth
        inp_shape: [192, 256]
        out_shape: [48, 64]
        gaussian_kernels: [2.6, 2., 1.7, 1.4] # sigma = 0.3*((ksize-1)*0.5 - 1) + 0.8
        parse_threshold: 0.1
    dataset:
        mean_std_file: mean_std_resnet_pretrained.pth
        ext_border: [0.1, 0.15]
        scale_factor: 0.25
        rotate_factor: 30
        translation_factor: 0.05

bayproj:
    <<: *DEFAULT
    name: baybase
    id: 13
    learning_rate: 5.e-4
    lr_gamma: 0.5
    epochs: 200
    schedule: []
    train_batch: 32
    test_batch: 3
    freeze_backbone: false
    bayproj_lr: 5.e-4
    early_pred_start: 1000
    early_pred_end: 1000
    model:
        resnet_pretrained: pretrained/resnet50_gn.pth
        loss_outsider_cof: 0.001
        loss_close_cof: 0.001
        inp_shape: [192, 256] # W, H
        out_shape: [48, 64] # W, H
        gaussian_kernels: [2.6, 2., 1.7, 1.4] # sigma = 0.3*((ksize-1)*0.5 - 1) + 0.8
        parse_threshold: 0.1
        detail:
            block_index: [null, 1, null, null]
            use_acorr: true
            regress_std: false
            proj_mode: samp
            radius_std_init: [7, 5, 3, 1]
            proj_data: false
            proj_summary_mode: sum
            proj_use_conv_final: false
            regress_kernel_size: [7, 7, 3, 3]
            regress_stride: [3, 3, 1, 1]
            proj_samp_sigma: [10., 7., 4., 2.]
            early_pred_kernel: 2. # with res_index==2 and block_index==1, should be same size in the second gaussian_kernel
            proj_local_mask_sigma: [0, 0, 0, 0]
    dataset:
        mean_std_file: mean_std_resnet_pretrained.pth
        ext_border: [0.1, 0.15]
        scale_factor: 0.25
        rotate_factor: 30
        translation_factor: 0.05

offset:
    <<: *DEFAULT
    name: offset
    id: 24
    learning_rate: 5.e-4
    lr_gamma: 0.5
    epochs: 100
    schedule: []
    train_batch: 16
    test_batch: 16
    learnable_offset:
        train_min_step: 6543
        lr: 1.e-2
        lr_gamma: 0.8
        lr_decay_step: 50000
        momentum: 0.0
        sigma: [0.5, 0.5, 0.5, null]
        balance_grad: false
        move_average_cycle: 500
        sigma_decay_step: 100000
        sigma_decay_rate: 0.8
        offset_save_interval: 1000
        free_chan_per_pos: [4, 8, 16, null]
        dconv_for_LO_stride: [1, 1, 1, null]
        regress_offset: false
        grad_inside_only: false
    config:
        store_map: false
    model:
        resnet_pretrained: pretrained/resnet50_gn.pth
        inp_shape: [192, 256] # W, H
        out_shape: [48, 64] # W, H
        gaussian_kernels: [2.6, 2., 1.7, 1.4] # sigma = 0.3*((ksize-1)*0.5 - 1) + 0.8
        parse_threshold: 0.1
        resnet: 50
        detail:
            block_index: [1, 1, 1, null]
            early_predictor_label_index: [2, 1, 0]
            channels_per_pos: [8, 16, 32, null]
            displace_stride: [3, 3, 3, null]
            displace_size: [[9, 9], [7, 7], [5, 5], null]
            actual_stride: [3, 3, 3, null]
            displace_learnable_offset: true
            disable_displace: false
            random_offset_init: 0
            use_origin: true
            early_predictor: true
            loss_invisible: true
    dataset:
        mean_std_file: mean_std.pth
        ext_border: [0.1, 0.15]
        scale_factor: 0.25
        rotate_factor: 30
        translation_factor: 0.05

baymini_base:
    <<: *DEFAULT
    name: baymini
    id: 35
    learning_rate: 5.e-4
    lr_gamma: 0.5
    epochs: 100
    schedule: []
    train_batch: 16
    test_batch: 16
    config:
        store_map: false
    model:
        resnet_pretrained: null
        inp_shape: [192, 256] # W, H
        out_shape: [48, 64] # W, H
        gaussian_kernels: [2.6, 2., 1.7, 1.4] # sigma = 0.3*((ksize-1)*0.5 - 1) + 0.8
        parse_threshold: 0.1
        resnet: 50
        detail:
            block_index: [null, null, null, null]
            channels_per_pos: [16, 32, 64, null]
            displace_stride: [4, 4, 4, null]
            displace_size: [[5, 5], [5, 5], [3, 3], null]
            actual_stride: [4, 4, 4, null]
            displace_fill: false
            disable_displace: false
            use_dconv: true
            random_offset: 0
            use_origin: true
    dataset:
        mean_std_file: mean_std.pth
        ext_border: [0.1, 0.15]
        scale_factor: 0.25
        rotate_factor: 30
        translation_factor: 0.05

baycrf:
    <<: *DEFAULT
    name: baybase
    id: 14
    learning_rate: 5.e-4
    lr_gamma: 0.5
    epochs: 200
    schedule: []
    train_batch: 32
    test_batch: 32
    model:
        resnet_pretrained: pretrained/resnet50_gn.pth
        use_pretrained_before:
            res_index: 1
            block_index: 1
        inp_shape: [192, 256] # W, H
        out_shape: [48, 64] # W, H
        gaussian_kernels: [2.6, 2., 1.7, 1.4] # sigma = 0.3*((ksize-1)*0.5 - 1) + 0.8
        parse_threshold: 0.1
        detail:
            block_index: [null, 1, null, null]
            channels_per_pos: 3
            displace_stride: 4
    dataset:
        mean_std_file: mean_std_resnet_pretrained.pth
        ext_border: [0.1, 0.15]
        scale_factor: 0.25
        rotate_factor: 30
        translation_factor: 0.05

fulloffset:
    <<: *DEFAULT
    name: offset
    id: 31
    learning_rate: 5.e-4
    lr_gamma: 0.5
    epochs: 100
    schedule: []
    train_batch: 16
    test_batch: 16
    learnable_offset:
        train_min_step: 6543
        lr: 1.e-2
        regressor_lr: 5.e-3
        lr_gamma: 0.8
        lr_decay_step: 50000
        momentum: 0.0
        sigma: 0.5
        move_average_cycle: 500
        sigma_decay_step: 100000
        sigma_decay_rate: 0.8
        offset_save_interval: 1000
        bind_chan: 4
        half_reversed_offset: true
        dconv_for_LO_stride: 1
        regress_offset: true
        grad_inside_only: true
    config:
        store_map: false
    model:
        resnet_pretrained: pretrained/resnet50_gn.pth
        inp_shape: [192, 256] # W, H
        out_shape: [48, 64] # W, H
        gaussian_kernels: [2.6, 2., 1.7, 1.4] # sigma = 0.3*((ksize-1)*0.5 - 1) + 0.8
        parse_threshold: 0.1
        resnet: 50
        detail:
            early_predictor_label_index: [2, 1, 0]
            displace_learnable_offset: true
            random_offset_init: 0
            early_predictor: true
            loss_invisible: true
    dataset:
        mean_std_file: mean_std.pth
        ext_border: [0.1, 0.15]
        scale_factor: 0.25
        rotate_factor: 30
        translation_factor: 0.05